# ‚ùó TODO

- [ ] –î–æ–±–∞–≤–∏—Ç—å requirements.yml –∏ requirements.txt
- [ ] –î–æ–±–∞–≤–∏—Ç—å Gathering facts
- [ ] –î–æ–±–∞–≤–∏—Ç—å Prepared variables
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–∞—Å–∫–∏
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å j2
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–ª–ª–µ–∫—Ü–∏–∏
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å ansible.cfg
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å ansible-lint
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å yamllint
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å ansible doctor
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å Ansible galaxy
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å Molecule
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å pur
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≠—Ç–∞–ª–æ–Ω–Ω—ã–π dummy Ansible —Å—é–¥–∞ –∏–ª–∏ –≤ git
- [ ] –î–æ–±–∞–≤–∏—Ç—å Ansible vault
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≥–æ—Ç–æ–≤—ã–µ –∫—É—Å–∫–∏ ansible —Å—é–¥–∞ –∏–ª–∏ –≤ git
- [ ] –†–∞—Å—à–∏—Ä–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã —Å—Ç—Ä—É–∫—Ç—É—Ä
- [ ] –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –∏–Ω–µ—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ–º–∏–º–æ –±–∞–∑–æ–≤—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤

---

# üìñ Introduction

Ansible - –≠—Ç–æ —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏.

---

# üìö Structure of Ansible

–û–±—â–∏–π –ø—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã Ansible:

```shell title=ansible_structure
‚îú‚îÄ‚îÄ ansible.cfg          - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª Ansible
‚îú‚îÄ‚îÄ .ansible-lint        - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Ansible –ª–∏–Ω—Ç–µ—Ä–∞
‚îú‚îÄ‚îÄ ansible_playbook.yml - –ü–ª–µ–π–±—É–∫
‚îú‚îÄ‚îÄ files/               - –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å–æ —Å—Ç–∞—Ç–∏—á–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏
‚îú‚îÄ‚îÄ group_vars/          - –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –¥–ª—è –≥—Ä—É–ø–ø —É–∑–ª–æ–≤
‚îú‚îÄ‚îÄ host_vars/           - –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —É–∑–ª–æ–≤
‚îú‚îÄ‚îÄ inventory.ini        - –°–ø–∏—Å–æ–∫ —É–∑–ª–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç–µ .ini
‚îú‚îÄ‚îÄ inventory.yml        - –°–ø–∏—Å–æ–∫ —É–∑–ª–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç–µ .yml
‚îú‚îÄ‚îÄ LICENSE              - –õ–∏—Ü–µ–Ω–∑–∏—è
‚îú‚îÄ‚îÄ README.md            - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ roles/               - –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å —Ä–æ–ª—è–º–∏ Ansible
‚îú‚îÄ‚îÄ templates/           - –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å —à–∞–±–ª–æ–Ω–∞–º–∏
‚îî‚îÄ‚îÄ .yamllint            - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ yaml –ª–∏–Ω—Ç–µ—Ä–∞
```

## üìÑ Ansible Tasks

```yaml title=main.yml
- name: Debug ansible pkg mgr
```

## üìë Ansible Playbook

–û—Å–Ω–æ–≤–Ω–æ–π –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª –≤ Ansible - –≠—Ç–æ ansible playbook.

–°—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ –ø–ª–µ–π–±—É–∫ - –≠—Ç–æ –Ω–∞–±–æ—Ä –ø–ª–µ–µ–≤, –ø—Ä–∏–º–µ—Ä Ansible Play:

```yaml title=playbook.yml
---
- name: Simple play
  hosts: all
  tasks:
    - name: Hello World
      ansible.builtin.debug:
        msg: Hello World
```

Ansible Play - –≠—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–¥–µ—Ä–∂–∞—â–∞—è –Ω–∞–±–æ—Ä —Ç–∞—Å–∫–æ–≤ –∏/–∏–ª–∏ —Ä–æ–ª–µ–π –≤—ã–ø–æ–ª–Ω—è–µ–º—ã–µ –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –≥—Ä—É–ø–ø–µ —É–∑–ª–æ–≤.

Ansible Playbook –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º `.yml` –∏–ª–∏ `.yaml`

>[!TIP]
> –•–æ—Ä–æ—à–µ–π –ø—Ä–∞–∫—Ç–∏–∫–æ–π —è–≤–ª—è–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è `_` –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ `.yml`

## üìÑ Inventory

Ansible Inventory - –≠—Ç–æ —Ñ–∞–π–ª —Å–æ —Å–ø–∏—Å–∫–æ–º —Ö–æ—Å—Ç–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç–µ ini –∏–ª–∏ yaml, –∏—Ö –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ, –º–æ–≥—É—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏ –∏–º–µ—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ.

```yaml title=inventory.yml
---
all:
  hosts:
    server1:
      ansible_host: 10.10.10.10
    server2:
      ansible_host: 20.20.20.20

  children:
    web:
      hosts:
        server1:
        server2:
```

```ini title=inventory.ini
[web]
server1 ansible_host=10.10.10.10
server1 ansible_host=20.20.20.20
```

>[!TIP]
> –•–æ—Ä–æ—à–µ–π –ø—Ä–∞–∫—Ç–∏–∫–æ–π —è–≤–ª—è–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ yaml Inventory

## üóÉÔ∏è Files

`files/` - –≠—Ç–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å–æ —Å—Ç–∞—Ç–∏—á–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏, –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É

```shell title=files/
‚îú‚îÄ‚îÄ nginx.conf
‚îî‚îÄ‚îÄ nginx.service
```

## üë• Group and Host vars

–í Ansible —Å—É—â–µ—Å—Ç–≤—É—é—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ host_vars –∏ group_vars –Ω—É–∂–Ω—ã –æ–Ω–∏ –¥–ª—è –±–æ–ª—å—à–µ–π –≥–∏–±–∫–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Ansible, –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ –∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –≥—Ä—É–ø–ø —É–∑–ª–æ–≤ –∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö

```shell title=group_vars/
‚îú‚îÄ‚îÄ all.yml
‚îî‚îÄ‚îÄ web.yml
```

>[!NOTE]
> –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –±–æ–ª–µ–µ —á–∞—Å—Ç–Ω—ã—Ö –≥—Ä—É–ø–ø–∞—Ö —è–≤–ª—è—é—Ç—Å—è –±–æ–ª–µ–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–º–∏ —á–µ–º –≤ –æ–±—â–∏—Ö

–ü—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã `host_vars/`:

```shell title=host_vars/
‚îú‚îÄ‚îÄ server1.yml
‚îî‚îÄ‚îÄ server2.yml
```

>[!NOTE]
> –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `host_vars/` —è–≤–ª—è—é—Ç—Å—è –±–æ–ª–µ–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–º–∏ —á–µ–º `group_vars/`

–í–Ω—É—Ç—Ä–∏ –≤—Å–µ —Ñ–∞–π–ª—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Å–æ–±–æ–π –ø–æ—Ö–æ–∂–∏, –≤–æ—Ç –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä –æ–¥–Ω–æ–≥–æ –∏–∑ –Ω–∏—Ö:

```yaml title=all.yml
---
base_install_pkgs_list:
  - vim
  - git

nginx_install: true
```

## üß© Templates

–î–∏–∫–µ—Ç–æ—Ä–∏—è `templates/` –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ Ansible –ø–æ—Ö–æ–∂–∞ –Ω–∞ `files/`, —Ä–∞–∑–≤–µ, —á—Ç–æ `templates/` –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è —à–∞–±–ª–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ `.j2`.

–ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã `templates/`:

```shell title=templates/
‚îú‚îÄ‚îÄ nginx.conf.j2
‚îî‚îÄ‚îÄ nginx.service.j2
```

Jinja2 (j2) - –≠—Ç–æ —à–∞–±–ª–æ–Ω–∏–∑–∞—Ç–æ—Ä Python –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –≤ Ansible.

```j2 title=template.j2
nginx install = {{ nginx_install }}

{% for i in base_install_pkgs_list %}
install package {{ i }}
{% endfor %}
```

# ü§ì Advanced

## üîß Ansible.cfg

ansible.cfg - –≠—Ç–æ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π —Ñ–∞–π–ª —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º –Ω–∞—Å—Ç—Ä–æ–µ–∫

```ini title=ansible.cfg
[defaults]
inventory = inventory.yml

# Ignore man in the middle
host_key_checking = False
```

## üî® Prepared Variables

–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ - —ç—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Ä–∞–±–æ—Ç—ã Ansible.

```yaml title=all.yml
---
ansible_ssh_user: ansible
ansible_port: 666
ansible_python_interpreter: /usr/bin/python3

# Ignore attempt new ssh hosts
ansible_ssh_common_args: '-o StrictHostKeyChecking=accept-new'
```

## üèÉ‚Äç‚ôÄÔ∏è Gathering facts

- ansible_default_ipv4
- inventory_hostname

## üìö Structure Ansible Role

Ansible Role - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤ —Å–æ–¥–µ—Ä–∂–∞—â–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ —Ç–∞—Å–∫–∏ –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

–û–±—â–∏–π –ø—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã Ansible —Ä–æ–ª–∏:

```shell title=ansible_role/
‚îú‚îÄ‚îÄ defaults/  - –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
‚îú‚îÄ‚îÄ files/     - –°—Ç–∞—Ç–∏—á–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ handlers/  - –•—ç–Ω–¥–ª–µ—Ä—ã - –¢–∞—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ–º—ã–µ –≤ –∫–æ–Ω—Ü–µ —Ä–æ–ª–∏ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ
‚îú‚îÄ‚îÄ LICENSE    - –õ–∏—Ü–µ–Ω–∑–∏—è
‚îú‚îÄ‚îÄ molecule/  - –¢–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ README.md  - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ tasks/     - –¢–∞—Å–∫–∏
‚îî‚îÄ‚îÄ templates/ - –®–∞–±–ª–æ–Ω—ã
```

## üß© Jinja2

Jinja2 (j2) - –≠—Ç–æ —à–∞–±–ª–æ–Ω–∏–∑–∞—Ç–æ—Ä –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Ansible

```j2 title=template.j2
# Variable usage
{{ variable }}

# For usage
{% for element in array %}
{{ element }}
{% endfor %}
```

## üìö Structure Ansible Collection

---

# üòé Best practice

## üë®‚Äçüè´ Ansible-lint

## üë©‚Äçüè´ Yamllint

## ‚úçÔ∏è Ansible doctor

## ü§° Ansible galaxy

## üìù Molecule

---

# üè¢ Internal Links

- [[ASDF]]
- [[Virtualenv]]

---

# üåç Links

- [Ansible Website](https://www.ansible.com)

---
